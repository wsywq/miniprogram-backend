# 微信小程序 - 习惯打卡系统开发指南

## 🚀 快速开始

### 环境要求
- 微信开发者工具 (最新版本)
- Node.js 16+ (后端开发)
- 微信小程序开发账号

### 本地开发步骤

1. **克隆项目**
   ```bash
   git clone https://github.com/wsywq/miniprogram.git
   cd miniprogram
   ```

2. **导入小程序**
   - 打开微信开发者工具
   - 选择"导入项目"
   - 选择 `miniprogram` 文件夹作为项目目录
   - 填入你的小程序AppID

3. **配置API地址**
   - 修改 `miniprogram/app.js` 中的 `baseUrl`
   - 替换为你的后端API地址

4. **开始开发**
   - 在微信开发者工具中预览和调试
   - 修改代码后会自动刷新

## 📁 项目结构详解

```
miniprogram/
├── pages/                 # 页面文件
│   ├── index/             # 首页 - 习惯列表和快速打卡
│   ├── habit-form/        # 习惯创建/编辑页面
│   ├── checkin/           # 打卡详情页面
│   ├── statistics/        # 统计分析页面
│   ├── rewards/           # 积分奖励页面
│   └── profile/           # 个人中心页面
├── utils/                 # 工具函数
│   ├── api.js            # API请求封装和离线数据管理
│   ├── auth.js           # 微信登录和用户认证
│   ├── storage.js        # 本地存储和缓存管理
│   └── date.js           # 日期处理工具
├── app.js                # 应用入口文件
├── app.json              # 应用配置文件
└── app.wxss              # 全局样式文件
```

## 🔧 核心功能模块

### 1. 用户认证模块 (`utils/auth.js`)
- 微信授权登录
- Token管理
- 用户信息缓存
- 登录状态检查

### 2. API请求模块 (`utils/api.js`)
- 统一的HTTP请求封装
- 自动Token添加
- 错误处理
- 离线数据同步

### 3. 本地存储模块 (`utils/storage.js`)
- 数据存储管理
- 缓存机制
- 用户偏好设置
- 存储空间监控

### 4. 日期处理模块 (`utils/date.js`)
- 日期格式化
- 日历生成
- 时间范围计算
- 相对时间显示

## 📱 页面功能说明

### 首页 (`pages/index/`)
- **功能**: 习惯列表展示、快速打卡、今日概览
- **特点**: 支持下拉刷新、长按操作菜单
- **交互**: 点击习惯进入详情，点击打卡按钮快速打卡

### 习惯表单页 (`pages/habit-form/`)
- **功能**: 创建和编辑习惯
- **特点**: 图标选择器、分类管理、提醒设置
- **验证**: 表单验证和错误提示

### 打卡详情页 (`pages/checkin/`)
- **功能**: 习惯打卡记录、日历视图、统计信息
- **特点**: 日历打卡状态、补卡功能、图片上传
- **交互**: 长按日期补卡、打卡弹窗

### 统计分析页 (`pages/statistics/`)
- **功能**: 数据统计、趋势分析、成就展示
- **特点**: 多时间段切换、图表展示、排行榜
- **分享**: 支持统计数据分享

### 积分奖励页 (`pages/rewards/`)
- **功能**: 积分商城、奖励兑换、积分记录
- **特点**: 标签切换、等级系统、兑换确认
- **规则**: 积分获得规则说明

### 个人中心页 (`pages/profile/`)
- **功能**: 个人信息、设置管理、数据导出
- **特点**: 主题切换、通知设置、缓存清理
- **操作**: 退出登录、意见反馈

## 🎨 样式设计规范

### CSS变量系统
```css
:root {
  --primary-color: #4CAF50;      /* 主色调 */
  --primary-light: #81C784;      /* 主色调浅色 */
  --primary-dark: #388E3C;       /* 主色调深色 */
  --secondary-color: #FF9800;    /* 辅助色 */
  --background-color: #f5f5f5;   /* 背景色 */
  --card-background: #ffffff;    /* 卡片背景 */
  --text-primary: #333333;       /* 主要文字 */
  --text-secondary: #666666;     /* 次要文字 */
  --text-light: #999999;         /* 浅色文字 */
  --border-color: #e0e0e0;       /* 边框色 */
  --shadow: 0 2px 8px rgba(0,0,0,0.1); /* 阴影 */
  --radius: 8px;                 /* 圆角 */
  --spacing: 16px;               /* 间距 */
}
```

### 组件样式类
- `.card` - 卡片容器
- `.btn` - 按钮基础样式
- `.btn-primary` - 主要按钮
- `.btn-outline` - 边框按钮
- `.flex` - 弹性布局
- `.text-center` - 文字居中

### 响应式设计
- 支持不同屏幕尺寸适配
- 小屏幕设备优化
- 触摸友好的交互设计

## 🔌 API接口规范

### 认证接口
```javascript
// 用户登录
POST /api/auth/login
Body: { code, userInfo }
Response: { token, userInfo }

// 获取用户信息
GET /api/user/info
Headers: { Authorization: Bearer <token> }
Response: { userInfo }
```

### 习惯管理接口
```javascript
// 获取习惯列表
GET /api/habits
Response: [{ id, name, icon, category, ... }]

// 创建习惯
POST /api/habits
Body: { name, description, icon, category, frequency, reminder_time }

// 更新习惯
PUT /api/habits/:id
Body: { name, description, ... }

// 删除习惯
DELETE /api/habits/:id
```

### 打卡接口
```javascript
// 获取打卡记录
GET /api/checkins?habit_id=&start_date=&end_date=
Response: [{ id, habit_id, checkin_date, note, image }]

// 创建打卡记录
POST /api/checkins
Body: { habit_id, checkin_date, note, image }

// 补卡
POST /api/checkins/makeup
Body: { habit_id, date }
```

## 🧪 测试指南

### 功能测试清单
- [ ] 用户登录授权
- [ ] 习惯CRUD操作
- [ ] 打卡功能测试
- [ ] 离线数据同步
- [ ] 积分系统验证
- [ ] 统计数据准确性
- [ ] 页面跳转和返回
- [ ] 错误处理机制

### 兼容性测试
- [ ] iOS微信客户端
- [ ] Android微信客户端
- [ ] 不同屏幕尺寸
- [ ] 网络异常情况
- [ ] 数据边界情况

## 🚀 部署发布

### 小程序发布流程
1. **代码审查**: 确保代码质量和规范
2. **功能测试**: 完整的功能测试
3. **上传代码**: 使用微信开发者工具上传
4. **提交审核**: 填写版本信息提交审核
5. **发布上线**: 审核通过后发布

### 版本管理
- 使用语义化版本号 (如: 1.0.0)
- 维护更新日志
- 标记重要版本节点

## 🔧 常见问题

### Q: 如何配置微信小程序的域名白名单？
A: 在微信公众平台的小程序后台，进入"开发" -> "开发设置" -> "服务器域名"，添加你的API域名。

### Q: 如何处理用户拒绝授权的情况？
A: 在 `utils/auth.js` 中已经处理了授权失败的情况，会显示提示信息引导用户重新授权。

### Q: 如何添加新的页面？
A: 1. 在 `pages/` 目录下创建新页面文件夹；2. 在 `app.json` 的 `pages` 数组中添加页面路径。

### Q: 如何自定义主题色？
A: 修改 `app.wxss` 中的CSS变量值，特别是 `--primary-color` 等颜色变量。

## 📚 参考资源

- [微信小程序官方文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [微信小程序设计指南](https://developers.weixin.qq.com/miniprogram/design/)
- [WeUI组件库](https://github.com/Tencent/weui-wxss)

## 🤝 贡献指南

1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建 Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。
